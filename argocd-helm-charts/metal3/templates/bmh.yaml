{{- range $name, $host := .Values.bmh }}
---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: {{ $name }}
  namespace: metal3
spec:
  online: true
  bootMACAddress: {{ $host.mac | quote }}
  bmc:
    address: redfish-virtualmedia://{{ $host.bmc }}/redfish/v1/Systems/1
    credentialsName: {{ $host.secretName }}
    disableCertificateVerification: true
  preprovisioningNetworkDataName: {{ $name }}-network
  networkData:
    name: {{ $name }}-networkdata
    namespace: metal3
  userData:
    name: {{ $name }}-userdata
  rootDeviceHints:
    {{- if $host.rootDeviceSerialNumber }}
    serialNumber: {{ $host.rootDeviceSerialNumber }}
    {{- end }}
    {{- if $host.rootDeviceName }}
    deviceName: {{ $host.rootDeviceName }}
    {{- end }}
  image:
    checksum: https://cloud-images.ubuntu.com/{{ $host.os }}/current/SHA256SUMS
    url: https://cloud-images.ubuntu.com/{{ $host.os }}/current/{{ $host.os }}-server-cloudimg-amd64.img
    checksumType: auto
{{- end }}
