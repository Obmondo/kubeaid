puppetserver:
  puppetserver:
    name: puppetserver
    image: ghcr.io/voxpupuli/container-puppetserver
    tag: 7.13.0
    puppeturl: ""
    masters:
      ingress:
        enabled: false
      customentrypoints:
        enabled: true
        configmaps: |-
          #!/bin/bash

          set -e

          # Configure puppet to use a certificate autosign script (if it exists)
          # AUTOSIGN=true|false|path_to_autosign.conf
          if test -n "${PUPPETSERVER_ENC_PATH}" ; then
            puppet config set external_nodes "$PUPPETSERVER_ENC_PATH" --section server
          fi

  r10k:
    asSidecar: false
    code:
      viaHttps:
        credentials:
          existingSecret: puppet-git-secret

  hiera:
    name: hiera
    hieradataurl: ""

  postgresql:
    enabled: false

  puppetdb:
    enabled: true
    name: puppetdb
    image: ghcr.io/voxpupuli/container-puppetdb
    tag: 7.14.0
    extraEnv:
      PUPPETDB_POSTGRES_HOSTNAME: puppetserver-pgsql-rw

  puppetboard:
    enabled: true
    name: puppetboard
    image: ghcr.io/voxpupuli/puppetboard
    tag: 5.4.0

  metrics:
    prometheus:
      disableAPICheck: true
      puppetdb:
        enabled: true
      jmx:
        enabled: false

  global:
    extraEnv:
      AUTOSIGN: /etc/puppetlabs/code/environments/master/puppet_autosign.rb
      PUPPET_REPORTS: puppetdb,prometheus
      PUPPETSERVER_ENC_PATH: /etc/puppetlabs/code/environments/master/puppet_enc.rb
    postgresql:
      auth:
        existingSecret: puppetserver-pgsql-app
        secretKeys:
          usernameKey: username
          userPasswordKey: password

postgresql:
  instance: 1
  size: 2Gi
  recover: false
  resources:
    limits:
      memory: 256Mi
    requests:
      memory: 256Mi
      cpu: 100m
