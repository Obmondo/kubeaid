apiVersion: installation.mattermost.com/v1beta1
kind: Mattermost
metadata:
  name: {{ .Values.mattermost.name | default "mattermost" }}
spec:
  image: {{ .Values.mattermost.image | default "mattermost/mattermost-enterprise-edition" }}
  imagePullPolicy: {{ .Values.mattermost.imagePullPolicy | default "IfNotPresent" }}
  version: {{ .Values.mattermost.version | default "10.9.4" }}
  size: {{ .Values.mattermost.size | default "5000users" }}
  useServiceLoadBalancer: {{ .Values.mattermost.useServiceLoadBalancer | default false }}
  serviceAnnotations:
    {{- if .Values.mattermost.serviceAnnotations }}
{{ toYaml .Values.mattermost.serviceAnnotations | indent 4 }}
    {{- else }}
    {}
    {{- end }}
  ingress:
    enabled: {{ .Values.mattermost.ingress.enabled | default true }}
    {{- if .Values.mattermost.ingress.host }}
    host: {{ .Values.mattermost.ingress.host }}
    {{- end }}
    {{- if .Values.mattermost.ingress.annotations }}
    annotations:
{{ toYaml .Values.mattermost.ingress.annotations | indent 6 }}
    {{- end }}
  {{- if .Values.mattermost.mattermostEnv }}
  mattermostEnv:
{{ toYaml .Values.mattermost.mattermostEnv | indent 4 }}
  {{- end }}
  licenseSecret: {{ .Values.mattermost.licenseSecret | default "" }}
  database:
    external:
      secret: {{ .Values.mattermost.database.external.secret | default "db-credentials" }}
  fileStore:
    external:
      url: {{ .Values.mattermost.fileStore.external.url | default "s3.obmondo.com" }}
      bucket: {{ .Values.mattermost.fileStore.external.bucket | default "kbm-postgres-backups" }}
      secret: {{ .Values.mattermost.fileStore.external.secret | default "mattermost-pgsql-filestore-creds" }}

# This is an example of secret containing configuration of external database.
---
apiVersion: v1
data:
  DB_CONNECTION_STRING: cG9zdGdyZXM6Ly9tYXR0ZXJtb3N0LXBnc3FsLXJ3Lm1hdHRlcm1vc3Qtb3BlcmF0b3I6NTQzMi9tYXR0ZXJtb3N0P3Bhc3N3b3JkPUJpVU9mR1lOVk1TZkxSQmRUYnNqd0s5QXVhR2dnejRHQklMdkNSQjYwem41dE8zbzBPOHNQY0hLdnljOHNQbDcmdXNlcj1tYXR0ZXJtb3N0
kind: Secret
metadata:
  name: db-credentials
type: Opaque
---
# This is an example of secret containing credentials for an external file storage.

apiVersion: v1
data:
  accesskey: a2Jt
  secretkey: Ym9vM0xhbmVlcDRjdWlsYWV6dWxvb0No
kind: Secret
metadata:
  name: mattermost-pgsql-filestore-creds
type: Opaque
